<!-- gitlab-org/database-team/gitlab-com-database-testing:identifiable-note -->
### Database migrations

|           | 4 Warnings |
| --------- | -------------------- |
| :warning: |  <b>20200325104758 - AddTestMigrationThatExceedsTimingForRegularButNotPost</b> may need a<br /> [post-deploy migration](https://docs.gitlab.com/ee/development/post_deployment_migrations.html) to comply with [timing guidelines](https://docs.gitlab.com/ee/development/database_review.html#timing-guidelines-for-migrations). It took 5.08min, but should not exceed 3.0min |
| :warning: |  <b>20201015154529 - AddMigrationThatRequiresBackground</b> took 25.02min. Please add a comment that<br /> mentions Release Managers (`@gitlab-org/release/managers`) so they are informed. |
| :warning: |  <b>20201015154529 - AddMigrationThatRequiresBackground</b> may need a [background migration](https://docs.gitlab.com/ee/development/background_migrations.html) to<br /> comply with [timing guidelines](https://docs.gitlab.com/ee/development/database_review.html#timing-guidelines-for-migrations). It took 25.02min, but should not exceed 10.0min |
| :warning: |  <b>20210604233157 - MigrationThrowsException</b> did not complete successfully, check the job log<br /> for details |

Migrations included in this change have been executed on gitlab.com data for testing purposes. For details, please see the [migration testing pipeline](https://gitlab.com/gitlab-org/database-team/gitlab-com-database-testing/-/pipelines/4711) (limited access).

| Migration | Type | Total runtime | Result | DB size change |
| --------- | ---- | ------------- | ------ | -------------- |
| 20200325104758 - AddTestMigrationThatExceedsTimingForRegularButNotPost | Regular | 306.0 s | :warning: | +32.00 KiB |
| 20210602144718 - CreateTestTable | Regular | 1.8 s | :white_check_mark: | +40.00 KiB |
| 20201015154529 - AddMigrationThatRequiresBackground | Post deploy | 1502.0 s | :warning: | +32.00 KiB |
| 20210604232017 - DropTestTable | Post deploy | 1.2 s | :white_check_mark: | -24.00 KiB |
| 20210604233157 - MigrationThrowsException | Post deploy | 0.9 s | :boom: | +0.00 B |

<details>
<summary>Runtime Histogram for all migrations</summary>

| Query Runtime | Count |
|---------------|-------|
|0 seconds - 0.01 seconds | 0 |
|0.01 seconds - 0.1 seconds | 61 |
|0.1 seconds - 1 second | 5 |
|1 second - 5 minutes | 0 |
|5 minutes + | 0 |

</details>


#### :warning: Migration: <b>20200325104758 - AddTestMigrationThatExceedsTimingForRegularButNotPost</b>

* Type: Regular
* Duration: 306.0 s
* Database size change: +32.00 KiB


####  Migration: <b>20210602144718 - CreateTestTable</b>

* Type: Regular
* Duration: 1.8 s
* Database size change: +40.00 KiB

| Query | Calls | Total Time | Max Time | Mean Time | Rows |
| ----- | ----- | ---------- | -------- | --------- | ---- |
| <pre>CREATE TABLE "test_tables" ("id" bigserial primary key, "stars" bigint DEFAULT 0 NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, "title" text, "notes" text) &#x2F;&#x2A;application:test&#x2A;&#x2F;</pre> | 1 | 71.1 ms | 71.1 ms | 71.1 ms | 0 |
| <pre>ALTER TABLE "test_tables" ADD CONSTRAINT "check_0770ba173a" CHECK (char_length("title") <= 128), ADD CONSTRAINT "check_9cfc473dbc" CHECK (char_length("notes") <= 1024)<br />&#x2F;&#x2A;application:test&#x2A;&#x2F;</pre> | 1 | 6.4 ms | 6.4 ms | 6.4 ms | 0 |
| <pre>SELECT $1::regtype::oid</pre> | 1 | 0.0 ms | 0.0 ms | 0.0 ms | 1 |

<details>
<summary>Histogram for CreateTestTable</summary>

| Query Runtime | Count |
|---------------|-------|
|0 seconds - 0.01 seconds | 0 |
|0.01 seconds - 0.1 seconds | 28 |
|0.1 seconds - 1 second | 3 |
|1 second - 5 minutes | 0 |
|5 minutes + | 0 |

</details>

#### :warning: Migration: <b>20201015154529 - AddMigrationThatRequiresBackground</b>

* Type: Post deploy
* Duration: 1502.0 s
* Database size change: +32.00 KiB


####  Migration: <b>20210604232017 - DropTestTable</b>

* Type: Post deploy
* Duration: 1.2 s
* Database size change: -24.00 KiB

| Query | Calls | Total Time | Max Time | Mean Time | Rows |
| ----- | ----- | ---------- | -------- | --------- | ---- |
| <pre>DROP TABLE "test_tables" &#x2F;&#x2A;application:test&#x2A;&#x2F;</pre> | 1 | 5.7 ms | 5.7 ms | 5.7 ms | 0 |

<details>
<summary>Histogram for DropTestTable</summary>

| Query Runtime | Count |
|---------------|-------|
|0 seconds - 0.01 seconds | 0 |
|0.01 seconds - 0.1 seconds | 19 |
|0.1 seconds - 1 second | 1 |
|1 second - 5 minutes | 0 |
|5 minutes + | 0 |

</details>

#### :boom: Migration: <b>20210604233157 - MigrationThrowsException</b>

* Type: Post deploy
* Duration: 0.9 s
* Database size change: +0.00 B


<details>
<summary>Histogram for MigrationThrowsException</summary>

| Query Runtime | Count |
|---------------|-------|
|0 seconds - 0.01 seconds | 0 |
|0.01 seconds - 0.1 seconds | 14 |
|0.1 seconds - 1 second | 1 |
|1 second - 5 minutes | 0 |
|5 minutes + | 0 |

</details>


---

<details>
  <summary>Other migrations pending on GitLab.com</summary>

  | Migration | Type | Total runtime | Result | DB size change |
| --------- | ---- | ------------- | ------ | -------------- |
| 20210601233122 - UnrelatedMigration | Regular | 10000.0 s | :warning: | +0.00 B |

</details>

#### Clone Details
| Clone ID | Clone Created At | Clone Data Timestamp | Expected Removal Time |
| -------- | ---------------- | -------------------- | --------------------- |
| [`database-testing-651277`](https://console.postgres.ai/gitlab/gitlab-production-tunnel/instances/59/clones/database-testing-651277) | 2021-06-15 16:06:07 UTC | 2021-06-15 12:00:12 UTC | 2021-06-16 04:07:40 +0000 |

#### [Artifacts](https://gitlab.com/gitlab-org/database-team/gitlab-com-database-testing/-/jobs/1354666720/artifacts/browse/migration-testing/)

---
Brought to you by [gitlab-org/database-team/gitlab-com-database-testing](https://gitlab.com/gitlab-org/database-team/gitlab-com-database-testing). [Epic](https://gitlab.com/groups/gitlab-org/database-team/-/epics/9)
<!-- JSON: eyJ2ZXJzaW9uIjoxLCJkYXRhIjpbeyJtaWdyYXRpb24iOjIwMjAwMzI1MTA0
NzU4LCJ3YWxsdGltZSI6MzA1Ljk1MDk4MjIyNjA1ODg0LCJ0b3RhbF9kYXRh
YmFzZV9zaXplX2NoYW5nZSI6MzI3NjgsInN1Y2Nlc3MiOnRydWV9LHsibWln
cmF0aW9uIjoyMDIxMDYwMjE0NDcxOCwid2FsbHRpbWUiOjEuNzg3Mjg4MTU1
NDA2NzEzNSwidG90YWxfZGF0YWJhc2Vfc2l6ZV9jaGFuZ2UiOjQwOTYwLCJz
dWNjZXNzIjp0cnVlfSx7Im1pZ3JhdGlvbiI6MjAyMDEwMTUxNTQ1MjksIndh
bGx0aW1lIjoxNTAxLjk1MDk4MjIyNjA1ODgsInRvdGFsX2RhdGFiYXNlX3Np
emVfY2hhbmdlIjozMjc2OCwic3VjY2VzcyI6dHJ1ZX0seyJtaWdyYXRpb24i
OjIwMjEwNjA0MjMyMDE3LCJ3YWxsdGltZSI6MS4xNjUyNDc2NTgyNjc2MTcy
LCJ0b3RhbF9kYXRhYmFzZV9zaXplX2NoYW5nZSI6LTI0NTc2LCJzdWNjZXNz
Ijp0cnVlfSx7Im1pZ3JhdGlvbiI6MjAyMTA2MDQyMzMxNTcsIndhbGx0aW1l
IjowLjkzNjQ0NzU4NTAwMTU4NzksInRvdGFsX2RhdGFiYXNlX3NpemVfY2hh
bmdlIjowLCJzdWNjZXNzIjpmYWxzZX1dfQ==
 -->