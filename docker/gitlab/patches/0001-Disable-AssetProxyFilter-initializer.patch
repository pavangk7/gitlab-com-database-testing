From c54e103fdb274aa505de9a6b7c50c7768938895d Mon Sep 17 00:00:00 2001
From: Andreas Brandl <abrandl@gitlab.com>
Date: Thu, 23 Sep 2021 12:38:26 +0200
Subject: [PATCH] Load application settings upfront

---
 config/initializers/asset_proxy_settings.rb | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/config/initializers/asset_proxy_settings.rb b/config/initializers/asset_proxy_settings.rb
index 48eedcee681..05ded8c16af 100644
--- a/config/initializers/asset_proxy_settings.rb
+++ b/config/initializers/asset_proxy_settings.rb
@@ -1,8 +1,11 @@
 # frozen_string_literal: true
 
-#
+# As a workaround for https://gitlab.com/gitlab-org/gitlab/-/issues/341584,
+# we load ApplicationSetting here
+ApplicationSetting.first
+
 # Asset proxy settings
 #
 ActiveSupport.on_load(:active_record) do
-  Banzai::Filter::AssetProxyFilter.initialize_settings
+  #Banzai::Filter::AssetProxyFilter.initialize_settings
 end
-- 
2.32.0

